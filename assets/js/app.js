/** Commune Hub build: 2025-09-25T23:29:58.681Z */
import{useState as c,useCallback as N,useEffect as b,createElement as e,Fragment as P}from"@wordpress/element";const f=async(t,a={})=>{const s=await fetch(communeHub.root+t,{credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":communeHub.nonce},...a}),o=await s.json();if(!s.ok)throw o;return o};function S(){const[t,a]=c([]),[s,o]=c([]),[i,u]=c("hot"),[l,d]=c(0),[m,h]=c(""),[p,r]=c(!1),g=N(async()=>{a(await f("/communities"))},[]),n=N(async()=>{r(!0);const v=new URL(communeHub.root+"/posts");v.searchParams.set("sort",i),l&&v.searchParams.set("community",l),m&&v.searchParams.set("search",m);const y=await(await fetch(v)).json();o(y.posts),r(!1)},[i,l,m]);return b(()=>{g()},[]),b(()=>{n()},[n]),{communities:t,posts:s,sort:i,setSort:u,community:l,setCommunity:d,search:m,setSearch:h,loadingPosts:p,reloadPosts:n}}function C({post:t,onVote:a}){const s=t.user_vote||0;return e("div",{className:"ch-vote-box"},e("button",{className:s===1?"active-up":"",onClick:()=>a(t.id,s===1?"clear":"up")},"▲"),e("div",{className:"ch-vote-score"},t.votes.score),e("button",{className:s===-1?"active-down":"",onClick:()=>a(t.id,s===-1?"clear":"down")},"▼"))}function w({post:t,onVote:a}){return e("div",{className:"ch-card ch-post"},e(C,{post:t,onVote:a}),e("div",{className:"ch-post-content"},e("div",{className:"ch-post-meta"},e("span",null,"c/"+(t.community_name||"general")),e("span",null,"•"),e("span",null,t.author),e("span",null,"•"),e("span",null,new Date(t.time).toLocaleString())),e("div",{className:"ch-post-title"},t.title),e("div",{className:"ch-tags"},t.tags&&t.tags.map(s=>e("span",{className:"ch-tag",key:s},s))),e("div",{className:"ch-actions"},e("button",null,"Comments ("+t.comment_count+")"),e("button",null,"Share"),e("button",null,"Report"))))}function k({posts:t,loading:a,onVote:s}){return a&&!t.length?e("div",{className:"ch-card ch-empty"},"Loading..."):!a&&!t.length?e("div",{className:"ch-card ch-empty"},"No posts found."):t.map(o=>e(w,{key:o.id,post:o,onVote:s}))}function L({communities:t}){return e("div",{className:"ch-card ch-sidebar-section"},e("h3",null,"Popular Communities"),t.map(a=>e("div",{key:a.id,className:"ch-community-item"},e("div",null,"c/"+a.name),e("span",{className:"ch-members-badge"},a.members+" members"))))}function E({post:t,onVote:a}){return e("div",{className:"ch-card ch-post"},e(C,{post:t,onVote:a}),e("div",{className:"ch-post-content"},e("div",{className:"ch-post-meta"},e("span",null,"c/"+(t.community_name||"general")),e("span",null,"•"),e("span",null,t.author),e("span",null,"•"),e("span",null,new Date(t.time).toLocaleString())),e("div",{className:"ch-post-title"},t.title),e("div",{className:"ch-tags"},t.tags&&t.tags.map(s=>e("span",{className:"ch-tag",key:s},s))),e("div",{className:"ch-actions"},e("button",null,"Comments ("+t.comment_count+")"),e("button",null,"Share"),e("button",null,"Report"))))}function _({communities:t,onCreated:a}){const[s,o]=c(!1),[i,u]=c(""),[l,d]=c(""),[m,h]=c(""),[p,r]=c(""),g=async()=>{!i||!l||(await f("/posts",{method:"POST",body:JSON.stringify({title:i,community_id:parseInt(l,10),content:m,tags:p.split(",").map(n=>n.trim()).filter(Boolean)})}),u(""),d(""),h(""),r(""),o(!1),a&&a())};return communeHub.currentUserId?e("div",{className:"ch-card ch-post-composer"},!s&&e("div",{style:{cursor:"text",color:"#64748b",fontSize:"14px"},onClick:()=>o(!0)},"Create something awesome..."),s&&e(P,null,e("input",{placeholder:"Title",value:i,onChange:n=>u(n.target.value)}),e("div",{className:"row"},e("select",{value:l,onChange:n=>d(n.target.value)},e("option",{value:""},"Select community"),t.map(n=>e("option",{key:n.id,value:n.id},n.name))),e("input",{placeholder:"tags (comma separated)",value:p,onChange:n=>r(n.target.value)})),e("textarea",{rows:5,placeholder:"Write...",value:m,onChange:n=>h(n.target.value)}),e("div",{className:"actions"},e("button",{className:"ch-btn-outline ch-btn",onClick:()=>o(!1)},"Cancel"),e("button",{className:"ch-btn",onClick:g},"Publish")))):e("div",{className:"ch-card ch-post-composer"},"Log in to create posts.")}function x({search:t,onSearch:a}){return e("div",{className:"ch-search"},e("input",{placeholder:"Search posts...",value:t,onChange:s=>a(s.target.value)}))}function H(){const t=S();return e("div",{className:"ch-app-shell"},e("div",{className:"ch-header"},e("div",{className:"ch-logo"},"CommuneHub"),e(x,{search:t.search,onSearch:a=>t.setSearch(a)}),e("button",{className:"ch-btn",onClick:t.reloadPosts},"Refresh")),e("div",{className:"ch-layout"},e("div",null,e(_,{communities:t.communities,onCreated:t.reloadPosts}),e(E,{active:t.sort,onChange:t.setSort}),e(k,{posts:t.posts,loading:t.loadingPosts,onVote:()=>{}})),e("div",null,e(L,{communities:t.communities}))))}const{createElement:I,render:T}=wp.element;document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("commune-hub-app");t&&T(I(H),t)});
