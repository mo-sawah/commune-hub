/** Commune Hub build: 2025-09-25T23:42:28.467Z */
(function(t){"use strict";const v=async(e,a={})=>{const c=await fetch(communeHub.root+e,{credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":communeHub.nonce},...a}),n=await c.json();if(!c.ok)throw n;return n};function N(){const[e,a]=t.useState([]),[c,n]=t.useState([]),[o,u]=t.useState("hot"),[r,m]=t.useState(0),[i,d]=t.useState(""),[h,l]=t.useState(!1),p=t.useCallback(async()=>{a(await v("/communities"))},[]),s=t.useCallback(async()=>{l(!0);const E=new URL(communeHub.root+"/posts");E.searchParams.set("sort",o),r&&E.searchParams.set("community",r),i&&E.searchParams.set("search",i);const _=await(await fetch(E)).json();n(_.posts),l(!1)},[o,r,i]);return t.useEffect(()=>{p()},[]),t.useEffect(()=>{s()},[s]),{communities:e,posts:c,sort:o,setSort:u,community:r,setCommunity:m,search:i,setSearch:d,loadingPosts:h,reloadPosts:s}}function g({post:e,onVote:a}){const c=e.user_vote||0;return t.createElement("div",{className:"ch-vote-box"},t.createElement("button",{className:c===1?"active-up":"",onClick:()=>a(e.id,c===1?"clear":"up")},"▲"),t.createElement("div",{className:"ch-vote-score"},e.votes.score),t.createElement("button",{className:c===-1?"active-down":"",onClick:()=>a(e.id,c===-1?"clear":"down")},"▼"))}function b({post:e,onVote:a}){return t.createElement("div",{className:"ch-card ch-post"},t.createElement(g,{post:e,onVote:a}),t.createElement("div",{className:"ch-post-content"},t.createElement("div",{className:"ch-post-meta"},t.createElement("span",null,"c/"+(e.community_name||"general")),t.createElement("span",null,"•"),t.createElement("span",null,e.author),t.createElement("span",null,"•"),t.createElement("span",null,new Date(e.time).toLocaleString())),t.createElement("div",{className:"ch-post-title"},e.title),t.createElement("div",{className:"ch-tags"},e.tags&&e.tags.map(c=>t.createElement("span",{className:"ch-tag",key:c},c))),t.createElement("div",{className:"ch-actions"},t.createElement("button",null,"Comments ("+e.comment_count+")"),t.createElement("button",null,"Share"),t.createElement("button",null,"Report"))))}function f({posts:e,loading:a,onVote:c}){return a&&!e.length?t.createElement("div",{className:"ch-card ch-empty"},"Loading..."):!a&&!e.length?t.createElement("div",{className:"ch-card ch-empty"},"No posts found."):e.map(n=>t.createElement(b,{key:n.id,post:n,onVote:c}))}function C({communities:e}){return t.createElement("div",{className:"ch-card ch-sidebar-section"},t.createElement("h3",null,"Popular Communities"),e.map(a=>t.createElement("div",{key:a.id,className:"ch-community-item"},t.createElement("div",null,"c/"+a.name),t.createElement("span",{className:"ch-members-badge"},a.members+" members"))))}function y({post:e,onVote:a}){return t.createElement("div",{className:"ch-card ch-post"},t.createElement(g,{post:e,onVote:a}),t.createElement("div",{className:"ch-post-content"},t.createElement("div",{className:"ch-post-meta"},t.createElement("span",null,"c/"+(e.community_name||"general")),t.createElement("span",null,"•"),t.createElement("span",null,e.author),t.createElement("span",null,"•"),t.createElement("span",null,new Date(e.time).toLocaleString())),t.createElement("div",{className:"ch-post-title"},e.title),t.createElement("div",{className:"ch-tags"},e.tags&&e.tags.map(c=>t.createElement("span",{className:"ch-tag",key:c},c))),t.createElement("div",{className:"ch-actions"},t.createElement("button",null,"Comments ("+e.comment_count+")"),t.createElement("button",null,"Share"),t.createElement("button",null,"Report"))))}function S({communities:e,onCreated:a}){const[c,n]=t.useState(!1),[o,u]=t.useState(""),[r,m]=t.useState(""),[i,d]=t.useState(""),[h,l]=t.useState(""),p=async()=>{!o||!r||(await v("/posts",{method:"POST",body:JSON.stringify({title:o,community_id:parseInt(r,10),content:i,tags:h.split(",").map(s=>s.trim()).filter(Boolean)})}),u(""),m(""),d(""),l(""),n(!1),a&&a())};return communeHub.currentUserId?t.createElement("div",{className:"ch-card ch-post-composer"},!c&&t.createElement("div",{style:{cursor:"text",color:"#64748b",fontSize:"14px"},onClick:()=>n(!0)},"Create something awesome..."),c&&t.createElement(t.Fragment,null,t.createElement("input",{placeholder:"Title",value:o,onChange:s=>u(s.target.value)}),t.createElement("div",{className:"row"},t.createElement("select",{value:r,onChange:s=>m(s.target.value)},t.createElement("option",{value:""},"Select community"),e.map(s=>t.createElement("option",{key:s.id,value:s.id},s.name))),t.createElement("input",{placeholder:"tags (comma separated)",value:h,onChange:s=>l(s.target.value)})),t.createElement("textarea",{rows:5,placeholder:"Write...",value:i,onChange:s=>d(s.target.value)}),t.createElement("div",{className:"actions"},t.createElement("button",{className:"ch-btn-outline ch-btn",onClick:()=>n(!1)},"Cancel"),t.createElement("button",{className:"ch-btn",onClick:p},"Publish")))):t.createElement("div",{className:"ch-card ch-post-composer"},"Log in to create posts.")}function P({search:e,onSearch:a}){return t.createElement("div",{className:"ch-search"},t.createElement("input",{placeholder:"Search posts...",value:e,onChange:c=>a(c.target.value)}))}function w(){const e=N();return t.createElement("div",{className:"ch-app-shell"},t.createElement("div",{className:"ch-header"},t.createElement("div",{className:"ch-logo"},"CommuneHub"),t.createElement(P,{search:e.search,onSearch:a=>e.setSearch(a)}),t.createElement("button",{className:"ch-btn",onClick:e.reloadPosts},"Refresh")),t.createElement("div",{className:"ch-layout"},t.createElement("div",null,t.createElement(S,{communities:e.communities,onCreated:e.reloadPosts}),t.createElement(y,{active:e.sort,onChange:e.setSort}),t.createElement(f,{posts:e.posts,loading:e.loadingPosts,onVote:()=>{}})),t.createElement("div",null,t.createElement(C,{communities:e.communities}))))}const{createElement:k,render:L}=wp.element;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("commune-hub-app");e&&L(k(w),e)})})(wp.element);
